<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pollinations Link Generator</title>
  <style>
    :root{
      --bg:#0b0b0d; --card:#0f1113; --muted:#9aa3ad; --accent:#6ee7b7;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Helvetica Neue", Arial; background:linear-gradient(180deg,#060607 0%, #0b0b0d 100%); color:#e6eef3; min-height:100vh;}
    .wrap{max-width:980px;margin:36px auto;padding:24px}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,#0ea5a4,#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:20px;margin:0}
    p.lead{color:var(--muted);margin:6px 0 0;font-size:13px}.controls{display:flex;gap:10px;flex-wrap:wrap;margin:18px 0}
button, .file-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 12px;border-radius:10px;cursor:pointer}
button.secondary{color:var(--muted);border-color:rgba(255,255,255,0.03)}
.links{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}

.card{background:var(--card);padding:12px;border-radius:12px;display:flex;align-items:center;gap:12px;justify-content:space-between;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
.meta{flex:1;min-width:0}
.prompt{font-size:14px;line-height:1.3;color:#e9f2f7;overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical}
.url{font-size:12px;color:var(--muted);margin-top:8px;word-break:break-all}
.actions{display:flex;gap:8px}
.small{font-size:13px;padding:6px 8px;border-radius:8px}
.seed{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.03);color:var(--muted)}

footer{margin-top:22px;color:var(--muted);font-size:13px}
.hidden{display:none}

@media(min-width:700px){.links{grid-template-columns:1fr 1fr}}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">PL</div>
      <div>
        <h1>Pollinations Link Generator</h1>
        <p class="lead">Reads <code>p.json</code> (same folder) and creates clickable links for each prompt. Click a link to open image in new tab.</p>
      </div>
    </header><div class="controls">
  <label class="file-btn" id="loadBtn">Load <code>p.json</code></label>
  <button id="regenerateBtn">Regenerate seeds</button>
  <button id="openAllBtn" class="secondary">Open all</button>
  <button id="copyAllBtn" class="secondary">Copy all URLs</button>
</div>

<div id="status" class="lead" style="margin-top:6px;color:var(--muted);">Waiting for <code>p.json</code> in the same folder. Example formats supported: JSON array of strings, plain text with one prompt per line, or object with a <code>prompts</code> array.</div>

<div class="links" id="links"></div>

<footer>
  Base link pattern used: <code>https://image.pollinations.ai/prompt/flux/{encoded}?&seed={seed}&nologo=true</code><br>
  Seeds are random integers between 1 and 999 (inclusive). Links open with <code>target="_blank" rel="noopener noreferrer"</code>.
</footer>

  </div>  <script>
    // Utility: fetch p.json from same folder. If the file isn't hosted (file://) some browsers block fetch.
    const linksEl = document.getElementById('links');
    const statusEl = document.getElementById('status');
    const loadBtn = document.getElementById('loadBtn');
    const regenerateBtn = document.getElementById('regenerateBtn');
    const openAllBtn = document.getElementById('openAllBtn');
    const copyAllBtn = document.getElementById('copyAllBtn');

    // Base link template (use exactly as requested)
    const makeUrl = (encoded, seed) => `https://image.pollinations.ai/prompt/flux/${encoded}?&seed=${seed}&nologo=true`;

    // Attempt to fetch p.json automatically. If that fails (CORS or file://) user can trigger manual load.
    async function loadPrompts(){
      try{
        statusEl.textContent = 'Loading p.json...';
        const resp = await fetch('./p.json', {cache: 'no-store'});
        if(!resp.ok) throw new Error('Could not fetch p.json — HTTP ' + resp.status);
        const text = await resp.text();
        // Try parse as JSON first
        let parsed;
        try{ parsed = JSON.parse(text); }
        catch(e){ parsed = text; }
        const prompts = normalizePrompts(parsed);
        if(!prompts || prompts.length===0) throw new Error('No prompts found in p.json');
        render(prompts);
        statusEl.textContent = `Loaded ${prompts.length} prompt${prompts.length>1?'s':''}.`;
      }catch(err){
        statusEl.textContent = 'Auto-load failed: ' + err.message + ' — Click "Load p.json" if you want to paste or upload content.';
      }
    }

    function normalizePrompts(parsed){
      // Acceptable formats:
      // 1) Array of strings: ["Prompt 1","Prompt 2"]
      // 2) Object with prompts: { "prompts": [ ... ] }
      // 3) Plain text with numbered or newline lines: "1. Prompt 1\n2. Prompt 2"
      let arr = [];
      if(Array.isArray(parsed)){
        arr = parsed.map(s=>String(s).trim()).filter(Boolean);
      } else if(parsed && typeof parsed === 'object'){
        if(Array.isArray(parsed.prompts)) arr = parsed.prompts.map(s=>String(s).trim()).filter(Boolean);
        else { // try to flatten object values
          arr = Object.values(parsed).flat().map(s=>String(s).trim()).filter(Boolean);
        }
      } else if(typeof parsed === 'string'){
        // split by newlines and remove numbering like "1. " or "1) "
        arr = parsed.split(/\r?\n/).map(line=>line.replace(/^\s*\d+\s*[\.|\)]\s*/,'').trim()).filter(Boolean);
      }
      return arr;
    }

    function randomSeed(){ return Math.floor(Math.random()*999) + 1; }

    function render(prompts){
      linksEl.innerHTML = '';
      prompts.forEach((prompt, idx)=>{
        const seed = randomSeed();
        const encoded = encodeURIComponent(prompt);
        const url = makeUrl(encoded, seed);

        const card = document.createElement('div'); card.className='card';
        const meta = document.createElement('div'); meta.className='meta';
        const pEl = document.createElement('div'); pEl.className='prompt'; pEl.textContent = prompt;
        const urlEl = document.createElement('div'); urlEl.className='url'; urlEl.textContent = url;
        meta.appendChild(pEl); meta.appendChild(urlEl);

        const actions = document.createElement('div'); actions.className='actions';
        // Open link button
        const openBtn = document.createElement('a'); openBtn.className='small'; openBtn.textContent='Open'; openBtn.href = url; openBtn.target='_blank'; openBtn.rel='noopener noreferrer';
        // Copy
        const copyBtn = document.createElement('button'); copyBtn.className='small'; copyBtn.textContent='Copy'; copyBtn.onclick = ()=>{ navigator.clipboard.writeText(url).then(()=>{copyBtn.textContent='Copied'; setTimeout(()=>copyBtn.textContent='Copy',900);}).catch(()=>{alert('Copy failed — see browser security settings.');}); };
        // Seed badge (click to regenerate seed for this prompt)
        const seedBtn = document.createElement('button'); seedBtn.className='small seed'; seedBtn.textContent = 'seed: ' + seed;
        seedBtn.onclick = ()=>{ const newSeed = randomSeed(); const newUrl = makeUrl(encodeURIComponent(prompt), newSeed); urlEl.textContent = newUrl; openBtn.href = newUrl; seedBtn.textContent = 'seed: ' + newSeed; };

        actions.appendChild(seedBtn); actions.appendChild(openBtn); actions.appendChild(copyBtn);
        card.appendChild(meta); card.appendChild(actions);
        linksEl.appendChild(card);
      });
    }

    // Button: load p.json manually via file picker (helps with file:// usage)
    loadBtn.addEventListener('click', ()=>{
      const input = document.createElement('input'); input.type='file'; input.accept='.json,.txt';
      input.onchange = async (e)=>{
        const f = e.target.files[0];
        if(!f) return;
        const txt = await f.text();
        let parsed;
        try{ parsed = JSON.parse(txt); }catch(e){ parsed = txt; }
        const prompts = normalizePrompts(parsed);
        if(prompts.length===0) { statusEl.textContent = 'No prompts found in selected file.'; return; }
        render(prompts);
        statusEl.textContent = `Loaded ${prompts.length} prompt${prompts.length>1?'s':''} from file.`;
      };
      input.click();
    });

    regenerateBtn.addEventListener('click', ()=>{
      // Re-generate seeds for all displayed cards
      const cards = linksEl.querySelectorAll('.card');
      cards.forEach(card=>{
        const prompt = card.querySelector('.prompt').textContent;
        const seedBtn = card.querySelector('.seed');
        const urlEl = card.querySelector('.url');
        const openAnchor = card.querySelector('a');
        const newSeed = randomSeed();
        const newUrl = makeUrl(encodeURIComponent(prompt), newSeed);
        seedBtn.textContent = 'seed: ' + newSeed;
        urlEl.textContent = newUrl;
        openAnchor.href = newUrl;
      });
    });

    openAllBtn.addEventListener('click', ()=>{
      const anchors = linksEl.querySelectorAll('a');
      anchors.forEach(a=>{ window.open(a.href, '_blank', 'noopener'); });
    });

    copyAllBtn.addEventListener('click', async ()=>{
      const urls = Array.from(linksEl.querySelectorAll('.url')).map(d=>d.textContent).join('\n');
      try{ await navigator.clipboard.writeText(urls); copyAllBtn.textContent='Copied'; setTimeout(()=>copyAllBtn.textContent='Copy all URLs',900); }
      catch(e){ alert('Copy failed: ' + e.message); }
    });

    // Auto-run
    loadPrompts();

    // Helpful note for developers: example p.json file contents (save as p.json in same folder):
    // [
    //   "A majestic portrait of a cyberpunk fox wearing neon goggles",
    //   "Minimal dark eSports logo with sharp wings and a lightning bolt"
    // ]
    // Or as plain text file: 1. Prompt 1\n2. Prompt 2
  </script></body>
</html>
